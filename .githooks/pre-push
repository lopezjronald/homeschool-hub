#!/bin/sh

BRANCH="$(git rev-parse --abbrev-ref HEAD)"

# Block direct pushes to main
if [ "$BRANCH" = "main" ]; then
  echo ""
  echo "❌ Push rejected."
  echo "Direct pushes to 'main' are not allowed."
  echo "Create a feature branch and open a Pull Request."
  echo ""
  exit 1
fi

# Require branch name: HH-123-... or HH-123/...
PATTERN='^HH-[0-9]+[-/].+'

if echo "$BRANCH" | grep -Eq "$PATTERN"; then
  exit 0
fi

echo ""
echo "❌ Push rejected."
echo "Branch name must start with a Jira issue key."
echo ""
echo "Required format:"
echo "  HH-<number>-<description>"
echo "  HH-<number>/<description>"
echo ""
echo "Examples:"
echo "  HH-60-auth-flow-tests"
echo "  HH-60/auth-flow-tests"
echo ""
echo "Current branch: $BRANCH"
echo ""
exit 1