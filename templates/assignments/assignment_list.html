{% extends "base.html" %}
{% block title %}Assignments Â· Steadfast Scholars{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Assignments</h1>
    {% if can_create %}
    <a href="{% url 'assignments:assignment_create' %}" class="btn btn-primary">
      Add Assignment
    </a>
    {% endif %}
  </div>

  {% if assignments %}
    <div class="table-responsive">
      <table class="table table-hover">
        <thead class="table-light">
          <tr>
            <th>Title</th>
            <th>Child</th>
            <th>Curriculum</th>
            <th>Due Date</th>
            <th>Status</th>
            {% if can_create %}<th>Actions</th>{% endif %}
          </tr>
        </thead>
        <tbody>
          {% for assignment in assignments %}
            <tr{% if assignment.is_overdue %} class="table-danger"{% endif %}>
              <td>
                <a href="{% url 'assignments:assignment_detail' assignment.pk %}">{{ assignment.title }}</a>
                {% if assignment.is_overdue %}
                  <span class="badge bg-danger ms-1">Overdue</span>
                {% endif %}
              </td>
              <td>{{ assignment.child }}</td>
              <td>{{ assignment.curriculum.name }}</td>
              <td>{{ assignment.due_date|date:"M d, Y" }}</td>
              <td>
                {% if assignment.status == "complete" %}
                  <span class="badge bg-success">Complete</span>
                {% elif assignment.status == "submitted" %}
                  <span class="badge bg-info">Submitted</span>
                {% elif assignment.status == "in_progress" %}
                  <span class="badge bg-primary">In Progress</span>
                {% else %}
                  <span class="badge bg-secondary">Pending</span>
                {% endif %}
              </td>
              {% if can_create %}
              <td>
                {% if is_parent_or_admin or assignment.source == "teacher" and assignment.created_by_id == user.id %}
                  <a href="{% url 'assignments:assignment_update' assignment.pk %}" class="btn btn-sm btn-outline-secondary">Edit</a>
                {% endif %}
                {% if is_parent_or_admin %}
                  <a href="{% url 'assignments:assignment_delete' assignment.pk %}" class="btn btn-sm btn-outline-danger">Delete</a>
                {% endif %}
              </td>
              {% endif %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info" role="alert">
      <h4 class="alert-heading">No assignments yet</h4>
      <p>You haven't added any assignments. Assignments link your children with curriculum entries and help track their progress.</p>
      <hr>
      {% if can_create %}
      <a href="{% url 'assignments:assignment_create' %}" class="btn btn-primary">Add Your First Assignment</a>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
